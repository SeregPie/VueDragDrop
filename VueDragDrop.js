!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueDragDrop=e()}(this,function(){"use strict";function n(t){return"function"==typeof t}function o(t){return n(t)?t:(e=t,function(){return e});var e}var t={tag:{type:String,default:"div"},revertDuration:{type:Number,default:0},restrict:{},data:{}},i={left:0,top:0,width:0,height:0},r={width:0,height:0},s={left:0,top:0,width:1/0,height:1/0};function e(){}function u(t,e,n){return Math.min(Math.max(t,e),n)}function h(t,i){var o={};return Object.entries(t).forEach(function(t){var e=t[0],n=t[1];o[e]=i(n,e)}),o}var a={position:function(){var t=this.ghostSize,e=this.pointerPosition,n=this.restrictBounds;return{left:u(e.left,n.left,n.left+n.width-t.width),top:u(e.top,n.top,n.top+n.height-t.height)}},relativePosition:function(){var t=this.elementBounds,e=this.position;return{left:e.left-t.left,top:e.top-t.top}},windowEventListeners:function(){var e=this;return h({mousemove:this.onMouseMove,mouseup:this.onMouseUp},function(t){return t.bind(e)})}};var c=function(t){return Array.isArray(t)?t.map(c):(e=t)&&"object"==typeof e?h(t,c):t;var e};var f={emitDrag:function(){var t=this.position,e=this.data;t=c(t),this.$emit("drag",{position:t,data:e})},emitDragEnd:function(){var t=this.position,e=this.data;t=c(t),this.$emit("drag-end",{position:t,data:e})},emitDragStart:function(){var t=this.position,e=this.data;t=c(t),this.$emit("drag-start",{position:t,data:e})},getElementBounds:function(){var t=this.$el;if(t){var e=t.getBoundingClientRect();return{left:e.left,top:e.top,width:e.width,height:e.height}}return i},getGhostSize:function(){var t=this.$refs;if(t){var e=t.ghost;if(e){var n=e.getBoundingClientRect();return{width:n.width,height:n.height}}}return r},getRestrictBounds:function(){var t,e=this.restrict;return n(e)&&(e=e()),(t=e)&&t._isVue&&(e=e.$el),e instanceof HTMLElement&&(e=e.getBoundingClientRect()),e?{left:e.left,top:e.top,width:e.width,height:e.height}:s},updateElementBounds:function(){Object.assign(this.elementBounds,this.getElementBounds())},updateGhostSize:function(){Object.assign(this.ghostSize,this.getGhostSize())},updateRestrictBounds:function(){Object.assign(this.restrictBounds,this.getRestrictBounds())}};function d(t){return t}var g={name:"VueDragItem",mixins:[function(t){var e=t.get,n=t.default;e=o(e);var i={};return Object.keys(n).forEach(function(n){i[n]=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return this.strategy[n].apply(this,t)}}),{data:function(){return{getPartialStrategy:e}},computed:{strategy:function(){return Object.assign({},n,this.getPartialStrategy(function(t){this.getPartialStrategy=t?o(t):e}.bind(this)))}},methods:i}}({get:function(e){return{onTouchStart:function(t){1===t.touches.length&&(t.preventDefault(),e({onTouchMove:function(t){1===t.touches.length&&(t.preventDefault(),this.dragged=!0,this.pointerPosition={left:t.touches[0].clientX,top:t.touches[0].clientY},this.emitDragStart(),this.emitDrag(),e({onTouchMove:function(t){1===t.touches.length&&(t.preventDefault(),this.pointerPosition={left:t.touches[0].clientX,top:t.touches[0].clientY},this.emitDrag())},onTouchEnd:function(t){1===t.changedTouches.length&&(t.preventDefault(),this.pointerPosition={left:t.changedTouches[0].clientX,top:t.changedTouches[0].clientY},this.dragged=!1,this.emitDragEnd(),e())}}))},onTouchEnd:function(t){1===t.changedTouches.length&&(t.preventDefault(),e())}}))},onMouseDown:function(t){1===t.which&&(t.preventDefault(),e({onMouseMove:function(t){t.preventDefault(),this.dragged=!0,this.pointerPosition={left:t.clientX,top:t.clientY},this.emitDragStart(),this.emitDrag(),e({onMouseMove:function(t){t.preventDefault(),this.pointerPosition={left:t.clientX,top:t.clientY},this.emitDrag()},onMouseUp:function(t){1===t.which&&(t.preventDefault(),this.pointerPosition={left:t.clientX,top:t.clientY},this.dragged=!1,this.emitDragEnd(),e())}})},onMouseUp:function(t){1===t.which&&(t.preventDefault(),e())}}))}}},default:{onTouchStart:e,onTouchMove:e,onTouchEnd:e,onMouseDown:e,onMouseMove:e,onMouseUp:e}})],props:t,data:function(){return{dragged:!1,pointerPosition:{left:0,top:0},elementBounds:i,ghostSize:r,restrictBounds:s}},computed:a,mounted:function(){var t,e,n,i=this;Object.entries(this.windowEventListeners).forEach(function(t){var e=t[0],n=t[1];window.addEventListener(e,n)}),t=function(){if(i._isDestroyed)return!1;i.updateElementBounds(),i.updateGhostSize(),i.updateRestrictBounds()},e=1e3,(n=function(){requestAnimationFrame(function(){!1!==t()&&setTimeout(n,e)})})()},beforeDestroy:function(){Object.entries(this.windowEventListeners).forEach(function(t){var e=t[0],n=t[1];window.removeEventListener(e,n)})},methods:f,render:function(t){var e=this,n=this,i=n.$scopedSlots,o=n.dragged,r=(n.relativePosition,n.revertDuration,n.tag),s=t(r,{style:{position:"relative"},ref:"ghost"},[(i=Object.assign({},{default:d},i)).default({dragged:o})]);return t(r,{style:{display:"inline-block"},on:h({touchstart:this.onTouchStart,touchmove:this.onTouchMove,touchend:this.onTouchEnd,mousedown:this.onMouseDown},function(t){return t.bind(e)})},[s])}},l=Object.freeze({DragItem:g}),p=Object.assign({},{install:function(e){Object.values(this.components).forEach(function(t){e.component(t.name,t)})},components:l},l);return"undefined"!=typeof window&&window.Vue&&window.Vue.use(p),p});
